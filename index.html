<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0f766e" />
    <title>Mini4WD Race Analyzer</title>
    <link rel="manifest" href="./manifest.json" />
    <link rel="icon" href="./favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="app-header">
      <h1>Mini4WD Race Analyzer</h1>
      <div id="appVersion" class="version"></div>
      <button id="installBtn" class="ghost" hidden>アプリをインストール</button>
    </header>

    <main class="container">
      <section class="card" aria-labelledby="group-create-title">
        <h2 id="group-create-title">グループ作成</h2>
        <form id="groupCreateForm" class="row" autocomplete="off">
          <label class="stack">
            <span>グループ名（例: 東京大会 一次予選）</span>
            <input id="groupNameInput" type="text" required minlength="2" placeholder="東京大会 一次予選" />
          </label>
          <button type="submit" class="primary">作成</button>
        </form>
      </section>

      <section class="card" aria-labelledby="group-list-title">
        <h2 id="group-list-title">グループ一覧</h2>
        <div id="groupList" class="list"></div>
      </section>

      <section id="groupDetailSection" class="card hidden" aria-labelledby="group-detail-title">
        <div class="group-detail-header">
          <div class="group-title">
            <h2 id="group-detail-title">グループ詳細</h2>
            <div id="groupCreatedAt" class="muted small"></div>
          </div>
          <div class="group-actions">
            <button id="newRaceBtn" class="primary small">レース登録</button>
          </div>
        </div>
        <div id="groupStats" class="stats"></div>
        <div class="predict" aria-live="polite">
          <div class="row">
          <label class="stack" style="flex:1">
              <span>想定タイム（秒・0.01秒単位）</span>
              <input id="expectedTimeInput" type="number" min="0" step="0.01" placeholder="例: 12.34" />
          </label>
            <div class="stat" style="flex:1">
              <div class="label">１位になれる確率</div>
              <div id="winProb" class="value">-</div>
            </div>
          </div>
        </div>
        <div>
          <h3>ベストタイム ランキング</h3>
          <div id="rankList" class="list"></div>
        </div>
        <div>
          <h3>レース履歴</h3>
          <div id="raceList" class="list"></div>
        </div>
        <div class="danger-zone">
          <button id="deleteGroupBtn" class="danger ghost">グループ削除</button>
        </div>
      </section>
    </main>

    <!-- Race Modal -->
    <dialog id="raceDialog">
      <form method="dialog" id="raceForm" class="race-form">
        <header class="dialog-header">
          <h3>レース登録</h3>
          <button type="button" id="closeRaceDialog" class="icon-btn" aria-label="閉じる">&#x2715;</button>
        </header>

        <div class="stack" style="flex:1">
          <span>レース人数（1〜5）</span>
          <input type="hidden" id="participantsInput" value="4" />
          <div id="participantsBtns" class="btn-group" role="group" aria-label="レース人数"></div>
        </div>

        <div class="stopwatch">
          <div id="timerDisplay" class="timer">00:00.00</div>
          <div class="row">
            <button type="button" id="startBtn" class="primary">スタート</button>
            <button type="button" id="stopBtn" disabled>ストップ</button>
            <button type="button" id="resetBtn" class="ghost" disabled>リセット</button>
          </div>
          <div class="meta" id="recordedInfo"></div>
        </div>

        <div class="stack" style="flex:1">
          <span>完走人数（0〜参加人数）</span>
          <input type="hidden" id="finishersInput" value="0" />
          <div id="finishersBtns" class="btn-group" role="group" aria-label="完走人数"></div>
        </div>

        <footer class="dialog-footer">
          <button type="submit" id="saveRaceBtn" class="primary" disabled>保存</button>
        </footer>
      </form>
    </dialog>

    <!-- Edit Race Modal -->
    <dialog id="editRaceDialog">
      <form method="dialog" id="editRaceForm" class="race-form">
        <header class="dialog-header">
          <h3>レース編集</h3>
          <button type="button" id="closeEditDialog" class="ghost">閉じる</button>
        </header>

        <div class="row">
          <label class="stack">
            <span>レース人数</span>
            <input id="editParticipantsDisplay" type="number" readonly />
          </label>
          <label class="stack">
            <span>完走人数（0〜参加人数）</span>
            <input id="editFinishersInput" type="number" min="0" max="5" required />
          </label>
        </div>

        <div class="row">
          <label class="stack" style="flex:1">
            <span>１位タイム（秒・0.01秒単位）</span>
            <input id="editFirstTimeInput" type="number" min="0" step="0.01" placeholder="例: 12.34" />
          </label>
        </div>

        <footer class="dialog-footer">
          <button type="submit" id="saveEditBtn" class="primary">保存</button>
        </footer>
      </form>
    </dialog>

    <script src="./version.js"></script>
    <script src="./app.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./service-worker.js');
        });
      }
    </script>
  </body>
  </html>
